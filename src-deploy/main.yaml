---
- name: "Proxmox init-configure"
  hosts: proxmox_nodes
  gather_facts: no
  become: yes

  roles:
    - proxmox-create-user
    - proxmox-customize-rocky-linux-cloud-image
    - proxmox-create-cloud-init-vm-template
    - terraform-create-vms

##############################################
# Running in all hosts
##############################################
- name: "Creating the user and configuring ssh"
  hosts: all
  become: yes
  gather_facts: yes

  roles:
    - create-user
    - create-ssh-config # atualiza o .ssh/config do meu client

##############################################
# Running only in 'nfs_server_hosts' group
##############################################
- name: "Configuring NFS Server"
  hosts: nfs_server_hosts
  become: yes
  gather_facts: no

  roles:
    - nfs-server

##############################################
# Configuring NFS clients
##############################################
- name: "Configuring NFS on clients"
  hosts: vms_all
  become: yes
  gather_facts: no

  roles:
    - nfs-client